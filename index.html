<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bring Up Japan - お知らせ</title>
  <style>
    body {
      font-family: "Hiragino Kaku Gothic Pro", "Noto Sans JP", sans-serif;
      margin: 0;
      padding: 0;
      background: #fafafa;
      color: #222;
      line-height: 1.6;
    }
    header {
      background: #2b4d90;
      color: white;
      text-align: center;
      padding: 1.5em 0;
    }
    main {
      max-width: 900px;
      margin: 2em auto;
      padding: 0 1em;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-top: 0;
      padding-top: 1em;
      font-size: 1.8em;
    }
    article {
      border-bottom: 1px solid #ddd;
      padding: 1.2em 0;
    }
    article:last-child {
      border-bottom: none;
    }
    h3 {
      margin-bottom: 0.2em;
      color: #2b4d90;
    }
    small {
      color: #777;
    }
    p {
      margin: 0.4em 0;
    }
    img {
      max-width: 100%;
      height: auto;
      margin: 8px 0;
      border-radius: 8px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
    }
    footer {
      text-align: center;
      padding: 1.5em;
      font-size: 0.9em;
      color: #555;
    }
  </style>
</head>
<body>
  <header>
    <h1>Bring Up Japan</h1>
    <p>地域と子どもたちのために</p>
  </header>

  <main>
    <h2>お知らせ</h2>
    <div id="news">
      <p>読み込み中...</p>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Bring Up Japan</p>
  </footer>

  <script>
  (async () => {
    try {
      // ✅ 루트 경로 자동 계산 (예: /bringupjp/)
      const prefix = (location.pathname.match(/^\/[^/]+\//) || ['/'])[0];
      const res = await fetch(`${prefix}buj-data.json`, { cache: 'no-store' });
      if (!res.ok) throw new Error("buj-data.json not found");
      const data = await res.json();

      const newsList = data.news || [];
      const root = document.querySelector('#news');
      root.innerHTML = "";

      if (!newsList.length) {
        root.innerHTML = "<p>現在お知らせはありません。</p>";
        return;
      }

      // 최신 글이 위로 오도록 정렬
      newsList.sort((a,b) => (b.date || "").localeCompare(a.date || ""));

      newsList.forEach(n => {
        const article = document.createElement('article');
        const title = n.title || "タイトル未設定";
        const date = n.date || "";
        const content = n.content || "";

        article.innerHTML = `
          <h3>${title}</h3>
          ${date ? `<p><small>${date}</small></p>` : ""}
          <div>${content}</div>
        `;

        // 📸 이미지가 있다면 렌더링
        if (Array.isArray(n.images)) {
          n.images.forEach(it => {
            const src = typeof it === "string" ? it : it.image;
            if (src) {
              const img = document.createElement("img");
              img.src = src.startsWith("http") ? src : `${prefix}${src.replace(/^\//, "")}`;
              img.alt = title;
              article.appendChild(img);
            }
          });
        }

        root.appendChild(article);
      });

    } catch (e) {
      console.error(e);
      document.querySelector('#news').innerHTML =
        "<p style='color:red'>お知らせの読み込みに失敗しました。</p>";
    }
  })();
  </script>
</body>
</html>
